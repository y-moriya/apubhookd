# APubHookD

Deno-based fork of [APubHook](https://github.com/castaneai/apubhook).

Incoming WebHook-like server for ActivityPub.

You can post messages to Fediverse like Incoming WebHook in Slack with the
command `curl -X POST -d '{"text": "hello"}' ...`

## Configuration

APubHookD works on [Deno Deploy](https://deno.com/deploy) using Deno KV.

Pick up the value of `PRIVATE_KEY` from the files generated by `ssh-keygen`:

```sh
ssh-keygen -b 4096 -m PKCS8 -t rsa -N '' -f id_rsa
```

You can also use the value as "Secret variables" in Deno Deploy.

## Deploy

First, create a project in Deno Deploy. Set the Environment Variables `PRIVATE_KEY` and `CREATE_ACCOUNT_ENDPOINT_UUID`.
Issue a Deploy Token and deploy using [deployctl](https://deno.com/deploy/docs/deployctl).

```sh
deployctl deploy --project=PROJECT_NAME --token=DEPLOY_TOKEN src/index.ts
```

## Usage

APubHookD can host multiple accounts on a single server. Accounts are managed in
Deno KV. To create an account, the API endpoint is `/api/createAccount/CREATE_ACCOUNT_ENDPOINT_UUID`,
where CREATE_ACCOUNT_ENDPOINT_UUID is configured in the .env file.
For example, the following command creates a BOT account named 'testbot'.
secretHookPath is a secret string used in the WebHook URL.

```sh
curl -X POST -d '{"username": "testbot", "displayName": "Test BOT", "secretHookPath": "secret-path-example", "iconUrl": "/static/icon.png", "iconMime": "image/png"}' "https://<PROJECT_NAME>.deno.dev/api/createAccount/<CREATE_ACCOUNT_ENDPOINT_UUID>"
```

Then you can follow a account: `@testbot@<PROJECT_NAME>.deno.dev` on Fediverse.

And you can post messages with HTTP POST request with JSON payload to
`/hooks/secret-path-example`.

```sh
# Sending 'hello' to Fediverse!
curl -X POST -d '{"text": "hello"}' "https://<PROJECT_NAME>.deno.dev/hooks/secret-path-example"
```

You can see the post on Fediverse!

![example.webp](./example.webp)

## License

MIT

And using a lot of code in Matchbox and inspired by Minidon and Express
ActivityPub Server.

Minidon https://github.com/yusukebe/minidon Copyright (c) 2023 Yusuke Wada.
Licensed under the MIT license.

Matchbox https://gitlab.com/acefed/matchbox Copyright (c) 2022 Acefed MIT
License

Express ActivityPub Server https://github.com/dariusk/express-activitypub
Copyright (c) 2018 Darius Kazemi. Licensed under the MIT license.
